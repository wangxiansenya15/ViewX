# äººæœºéªŒè¯åŠŸèƒ½ - å¿«é€Ÿå‚è€ƒ

## ğŸ“Œ é‡è¦è¯´æ˜

### âŒ æ‚¨ä¸éœ€è¦æ‹…å¿ƒçš„äº‹æƒ…

1. **ä¸éœ€è¦ä¿®æ”¹ DNS** - Cloudflare Turnstile æ˜¯ç‹¬ç«‹æœåŠ¡
2. **ä¸éœ€è¦ä½¿ç”¨ Cloudflare CDN** - åªæ˜¯ä¸€ä¸ªéªŒè¯ç»„ä»¶
3. **ä¸ä¼šå½±å“è®¿é—®é€Ÿåº¦** - åªåœ¨éœ€è¦æ—¶åŠ è½½å°è„šæœ¬

### âœ… æ¨èæ–¹æ¡ˆï¼šæ»‘å—éªŒè¯

**æœ€ç®€å•ã€æœ€å¿«é€Ÿã€å®Œå…¨è‡ªä¸»å¯æ§ï¼**

```yaml
# application.yml
captcha:
  enabled: true
  type: slider
```

å°±è¿™ä¹ˆç®€å•ï¼æ— éœ€æ³¨å†Œä»»ä½•ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚

---

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1. åç«¯é…ç½®ï¼ˆ1 åˆ†é’Ÿï¼‰

åœ¨ `src/main/resources/application.yml` ä¸­æ·»åŠ ï¼š

```yaml
captcha:
  enabled: true
  type: slider  # æˆ– turnstileï¼ˆéœ€è¦å¯†é’¥ï¼‰
```

### 2. å‰ç«¯ä½¿ç”¨ï¼ˆ2 åˆ†é’Ÿï¼‰

```vue
<template>
  <form @submit.prevent="handleLogin">
    <!-- æ‚¨çš„è¡¨å•å­—æ®µ -->
    
    <!-- äººæœºéªŒè¯ç»„ä»¶ -->
    <CaptchaVerification
      ref="captchaRef"
      type="slider"
      @verified="captchaToken = $event"
    />
    
    <button type="submit" :disabled="!captchaToken">ç™»å½•</button>
  </form>
</template>

<script setup>
import { ref } from 'vue';
import CaptchaVerification from '@/components/CaptchaVerification.vue';

const captchaToken = ref('');
const captchaRef = ref(null);

const handleLogin = async () => {
  // æäº¤æ—¶åŒ…å« captchaToken
  await axios.post('/api/auth/login', {
    username: username.value,
    password: password.value,
    captchaToken: captchaToken.value
  });
};
</script>
```

### 3. åç«¯éªŒè¯ï¼ˆ2 åˆ†é’Ÿï¼‰

```java
@PostMapping("/login")
public Result<LoginVO> login(@RequestBody LoginDTO dto, HttpServletRequest request) {
    // éªŒè¯äººæœºéªŒè¯
    String remoteIp = getClientIp(request);
    if (!captchaService.verifyCaptcha(dto.getCaptchaToken(), remoteIp)) {
        return Result.badRequest("äººæœºéªŒè¯å¤±è´¥");
    }
    
    // æ‚¨çš„ç™»å½•é€»è¾‘
    // ...
    
    return Result.success(loginVO);
}
```

åœ¨ DTO ä¸­æ·»åŠ å­—æ®µï¼š
```java
@Data
public class LoginDTO {
    private String username;
    private String password;
    private String captchaToken; // æ–°å¢è¿™ä¸€è¡Œ
}
```

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- [äººæœºéªŒè¯å®ç°æ€»ç»“](./äººæœºéªŒè¯å®ç°æ€»ç»“.md) - **å¿…è¯»ï¼** å®Œæ•´çš„å®ç°æŒ‡å—
- [äººæœºéªŒè¯æ–¹æ¡ˆé€‰æ‹©](./äººæœºéªŒè¯æ–¹æ¡ˆé€‰æ‹©.md) - ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”
- [Cloudflare Turnstile ä½¿ç”¨æŒ‡å—](./Cloudflare-Turnstile-ä½¿ç”¨æŒ‡å—.md) - Turnstile è¯¦ç»†æ•™ç¨‹

### é…ç½®æ–‡ä»¶
- `src/main/resources/application-captcha-template.yml` - é…ç½®æ¨¡æ¿
- `src/main/resources/captcha-config-example.yml` - é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ä»£ç 
- `ViewX-frontend/src/views/LoginExample.vue` - ç™»å½•é¡µé¢ç¤ºä¾‹

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### âœ… å¿…é¡»ä½¿ç”¨
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- å¯†ç é‡ç½®
- å‘å¸ƒå†…å®¹ï¼ˆè¯„è®ºã€è§†é¢‘ã€æ–‡ç« ï¼‰
- æŠ•ç¥¨/ç‚¹èµ

### âš ï¸ å»ºè®®ä½¿ç”¨
- æœç´¢åŠŸèƒ½
- è¡¨å•æäº¤
- ä¸‹è½½èµ„æº

### âŒ ä¸å»ºè®®ä½¿ç”¨
- æ™®é€šé¡µé¢æµè§ˆ
- æŸ¥çœ‹ä¸ªäººä¿¡æ¯

---

## ğŸ”„ åˆ‡æ¢éªŒè¯æ–¹å¼

### ä»æ»‘å—åˆ‡æ¢åˆ° Turnstile

1. æ³¨å†Œ Cloudflare Turnstileï¼ˆå…è´¹ï¼‰
2. è·å– Site Key å’Œ Secret Key
3. ä¿®æ”¹é…ç½®ï¼š

```yaml
captcha:
  type: turnstile  # ä» slider æ”¹ä¸º turnstile
  site-key: YOUR_SITE_KEY
  secret-key: YOUR_SECRET_KEY
```

å‰ç«¯è‡ªåŠ¨é€‚é…ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼

---

## ğŸ”’ å®‰å…¨æç¤º

### âŒ ä¸è¦è¿™æ ·åš
```yaml
# ä¸è¦ç›´æ¥å†™å¯†é’¥å¹¶æäº¤åˆ° Git
captcha:
  secret-key: 0x4AAAAAAAyyyyyyyyyyyyyyyyyyyy
```

### âœ… åº”è¯¥è¿™æ ·åš
```yaml
# ä½¿ç”¨ç¯å¢ƒå˜é‡
captcha:
  secret-key: ${CAPTCHA_SECRET_KEY}
```

---

## â“ å¸¸è§é—®é¢˜

**Q: éœ€è¦ä¿®æ”¹ DNS å—ï¼Ÿ**  
A: ä¸éœ€è¦ï¼

**Q: ä¼šå½±å“é€Ÿåº¦å—ï¼Ÿ**  
A: ä¸ä¼šï¼

**Q: åœ¨ä¸­å›½èƒ½ç”¨å—ï¼Ÿ**  
A: æ»‘å—éªŒè¯å®Œç¾æ”¯æŒï¼ŒTurnstile å¯èƒ½è¾ƒæ…¢ã€‚

**Q: å¦‚ä½•åˆ‡æ¢éªŒè¯æ–¹å¼ï¼Ÿ**  
A: åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ `type` å­—æ®µã€‚

**Q: å¦‚ä½•ä¸´æ—¶ç¦ç”¨ï¼Ÿ**  
A: è®¾ç½® `enabled: false`ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
ViewX/
â”œâ”€â”€ src/main/java/com/flowbrain/viewx/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ CaptchaController.java          # éªŒè¯ API
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ CaptchaService.java             # æ ¸å¿ƒéªŒè¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ SliderCaptchaService.java       # æ»‘å—éªŒè¯å¢å¼º
â”‚   â””â”€â”€ common/
â”‚       â””â”€â”€ Result.java                      # ç»Ÿä¸€è¿”å›ç±»
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application-captcha-template.yml     # é…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ captcha-config-example.yml           # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ ViewX-frontend/src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ CaptchaVerification.vue          # éªŒè¯ç»„ä»¶
â”‚   â””â”€â”€ views/
â”‚       â””â”€â”€ LoginExample.vue                 # ç™»å½•ç¤ºä¾‹
â””â”€â”€ docs/
    â”œâ”€â”€ äººæœºéªŒè¯å®ç°æ€»ç»“.md                   # å®Œæ•´æŒ‡å—
    â”œâ”€â”€ äººæœºéªŒè¯æ–¹æ¡ˆé€‰æ‹©.md                   # æ–¹æ¡ˆå¯¹æ¯”
    â””â”€â”€ Cloudflare-Turnstile-ä½¿ç”¨æŒ‡å—.md     # Turnstile æ•™ç¨‹
```

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

1. **é˜…è¯»** [äººæœºéªŒè¯å®ç°æ€»ç»“](./äººæœºéªŒè¯å®ç°æ€»ç»“.md)
2. **é…ç½®** `application.yml`
3. **é›†æˆ** åˆ°æ‚¨çš„ç™»å½•/æ³¨å†Œé¡µé¢
4. **æµ‹è¯•** éªŒè¯åŠŸèƒ½

å°±è¿™ä¹ˆç®€å•ï¼

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- [äººæœºéªŒè¯å®ç°æ€»ç»“](./äººæœºéªŒè¯å®ç°æ€»ç»“.md) - å®Œæ•´çš„å®ç°æŒ‡å—å’Œç¤ºä¾‹
- [äººæœºéªŒè¯æ–¹æ¡ˆé€‰æ‹©](./äººæœºéªŒè¯æ–¹æ¡ˆé€‰æ‹©.md) - å¸®åŠ©æ‚¨é€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆ
- [Cloudflare Turnstile ä½¿ç”¨æŒ‡å—](./Cloudflare-Turnstile-ä½¿ç”¨æŒ‡å—.md) - Turnstile è¯¦ç»†æ•™ç¨‹

---

**è®°ä½ï¼šæ¨èä½¿ç”¨æ»‘å—éªŒè¯ï¼Œç®€å•å¿«é€Ÿï¼Œæ— éœ€æ³¨å†Œï¼** ğŸš€
