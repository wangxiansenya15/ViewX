<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassStream - 沉浸式视频平台</title>

    <!-- 核心库 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 图标库 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Markdown 解析 (可选，用于更好显示 AI 结果) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 自定义样式 -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            /* 纯黑背景，增强对比 */
            color: #e5e5e5;
            overflow: hidden;
            /* 应用内滚动 */
            -webkit-font-smoothing: antialiased;
        }

        /* 隐藏滚动条但保留功能 */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* macOS 风格滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 核心毛玻璃类 */
        .glass-panel {
            background: rgba(20, 20, 23, 0.7);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            /* Safari 支持 */
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* AI 专属样式 */
        .ai-gradient-text {
            background: linear-gradient(to right, #818cf8, #c084fc, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: shine 3s linear infinite;
        }

        .ai-card {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(165, 180, 252, 0.2);
            backdrop-filter: blur(10px);
        }

        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }

        /* 弹性动画库 */
        .spring-transition {
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .hover-spring:hover {
            transform: scale(1.02) translateY(-2px);
        }

        .click-spring:active {
            transform: scale(0.96);
        }

        /* YouTube 风格加载条 */
        .loading-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff2e63, #08d9d6);
            z-index: 9999;
            box-shadow: 0 0 10px rgba(255, 46, 99, 0.7);
            transition: width 0.4s ease-out, opacity 0.3s ease;
        }

        /* B站风格弹幕动画 */
        @keyframes danmaku-slide {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(-150%);
            }

            /* 移动更远以完全离开屏幕 */
        }

        .danmaku-item {
            position: absolute;
            white-space: nowrap;
            user-select: none;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8), 0 0 1em rgba(0, 0, 0, 0.5);
            font-weight: 600;
            animation: danmaku-slide linear forwards;
            will-change: transform;
        }

        /* Vue 过渡动画 */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        .slide-up-enter-active,
        .slide-up-leave-active {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .slide-up-enter-from,
        .slide-up-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }
    </style>
</head>

<body>

    <div id="app"
        class="h-screen w-full flex flex-col relative text-gray-100 selection:bg-indigo-500 selection:text-white">

        <!-- 顶部进度条 -->
        <div class="loading-bar" :style="{ width: loadPercent + '%', opacity: isLoading ? 1 : 0 }"></div>

        <!-- 顶部导航栏 (Glassmorphism) -->
        <header class="glass-panel h-16 flex items-center justify-between px-6 z-40 fixed top-0 w-full border-b-0">
            <!-- Logo -->
            <div class="flex items-center gap-3 group cursor-pointer" @click="goHome">
                <div
                    class="w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center shadow-lg group-hover:rotate-12 spring-transition">
                    <i data-lucide="play" class="w-4 h-4 text-white fill-white"></i>
                </div>
                <span
                    class="text-xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">GlassStream</span>
            </div>

            <!-- 搜索栏 -->
            <div class="hidden md:flex flex-1 max-w-xl mx-8 relative">
                <input type="text" placeholder="搜索视频、UP主..."
                    class="w-full bg-black/20 border border-white/10 rounded-xl py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:bg-black/40 focus:border-indigo-500/50 transition-all placeholder-gray-500">
                <i data-lucide="search" class="absolute left-3.5 top-2.5 w-4 h-4 text-gray-500"></i>
            </div>

            <!-- 用户区 -->
            <div class="flex items-center gap-5">
                <button class="relative hover:text-white text-gray-400 transition-colors click-spring">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                    <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full border border-black"></span>
                </button>
                <div
                    class="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-400 to-cyan-300 p-[1px] cursor-pointer hover-spring">
                    <img src="https://api.dicebear.com/7.x/notionists/svg?seed=Felix"
                        class="rounded-full bg-black/50 w-full h-full object-cover">
                </div>
            </div>
        </header>

        <div class="flex flex-1 pt-16 h-full overflow-hidden relative z-10">

            <!-- 左侧导航 (Sidebar) -->
            <aside
                class="w-20 lg:w-64 hidden md:flex flex-col glass-panel border-t-0 border-b-0 border-r border-white/5 pt-6 pb-6 gap-6 z-20 transition-all duration-300">

                <nav class="flex flex-col px-3 gap-1">
                    <a v-for="item in navItems" :key="item.id" @click="activeTab = item.id"
                        :class="['flex items-center gap-4 px-4 py-3 rounded-xl transition-all cursor-pointer group mb-1', 
                            activeTab === item.id ? 'bg-white/10 text-white font-medium shadow-lg shadow-white/5' : 'text-gray-400 hover:bg-white/5 hover:text-gray-200']">
                        <i :data-lucide="item.icon"
                            :class="['w-5 h-5 transition-transform group-hover:scale-110', activeTab === item.id ? 'text-indigo-400' : '']"></i>
                        <span class="hidden lg:block text-sm">{{ item.name }}</span>
                    </a>
                </nav>

                <!-- AI Promo Card -->
                <div class="mt-auto px-4 hidden lg:block">
                    <div
                        class="glass-card p-4 rounded-2xl bg-gradient-to-br from-indigo-600/20 to-purple-600/10 border border-indigo-500/20">
                        <div class="flex items-center gap-2 mb-2 text-indigo-300">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase tracking-wider ai-gradient-text">Gemini
                                Power</span>
                        </div>
                        <p class="text-xs text-gray-300 mb-3 leading-relaxed">体验 AI 驱动的视频洞察与即时互动。</p>
                        <button
                            class="w-full py-2 bg-white text-black text-xs font-bold rounded-lg hover:bg-gray-200 spring-transition">了解更多</button>
                    </div>
                </div>
            </aside>

            <!-- 主内容区 -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth" ref="mainScroll">

                <!-- 分类标签 -->
                <div class="flex gap-3 mb-8 overflow-x-auto pb-2 scrollbar-hide mask-fade-right">
                    <button v-for="cat in categories" :key="cat"
                        class="px-5 py-2 rounded-full glass-card text-sm text-gray-300 hover:bg-white hover:text-black hover:border-transparent transition-all whitespace-nowrap click-spring">
                        {{ cat }}
                    </button>
                </div>

                <!-- 视频网格 -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6 pb-20">
                    <div v-for="video in videos" :key="video.id" @click="openVideo(video)"
                        class="group flex flex-col gap-3 cursor-pointer">
                        <!-- 封面容器 -->
                        <div
                            class="relative aspect-video rounded-xl overflow-hidden glass-card hover-spring shadow-lg hover:shadow-indigo-500/20">
                            <img :src="video.cover"
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                loading="lazy">

                            <!-- 悬浮播放按钮 -->
                            <div
                                class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-[2px]">
                                <div
                                    class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30">
                                    <i data-lucide="play" class="w-5 h-5 fill-white text-white ml-1"></i>
                                </div>
                            </div>

                            <!-- 时长标记 -->
                            <div
                                class="absolute bottom-2 right-2 bg-black/60 backdrop-blur-md text-[10px] px-1.5 py-0.5 rounded text-white font-medium border border-white/10">
                                {{ video.duration }}
                            </div>
                        </div>

                        <!-- 信息 -->
                        <div class="flex gap-3 px-1">
                            <img :src="video.avatar" class="w-9 h-9 rounded-full border border-white/10 bg-gray-800">
                            <div class="flex flex-col gap-1">
                                <h3
                                    class="text-sm font-bold text-gray-100 leading-tight line-clamp-2 group-hover:text-indigo-400 transition-colors">
                                    {{ video.title }}
                                </h3>
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <span>{{ video.author }}</span>
                                    <span class="w-0.5 h-0.5 rounded-full bg-gray-600"></span>
                                    <span>{{ video.views }}观看</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- 沉浸式详情页 (Modal) -->
        <transition name="fade">
            <div v-if="currentVideo" class="fixed inset-0 z-50 flex bg-[#050505] animate-in fade-in duration-300">

                <!-- 返回按钮 -->
                <div class="absolute top-6 left-6 z-50">
                    <button @click="closeVideo"
                        class="p-3 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/10 text-white spring-transition click-spring group">
                        <i data-lucide="arrow-left" class="w-6 h-6 group-hover:-translate-x-1 transition-transform"></i>
                    </button>
                </div>

                <!-- 内容容器 -->
                <div class="flex flex-col lg:flex-row w-full h-full">

                    <!-- 视频播放区 (左侧/上方) -->
                    <div class="flex-1 relative bg-black flex items-center justify-center group overflow-hidden">
                        <!-- 环境光背景 -->
                        <div class="absolute inset-0 opacity-30 blur-3xl scale-125 transition-all duration-1000"
                            :style="`background-image: url(${currentVideo.cover}); background-size: cover; background-position: center;`">
                        </div>

                        <!-- 模拟播放器 -->
                        <div
                            class="relative w-full max-w-5xl aspect-video bg-black shadow-2xl overflow-hidden group/player">
                            <img :src="currentVideo.cover" class="w-full h-full object-contain opacity-90">

                            <!-- 弹幕层 -->
                            <div class="absolute inset-0 overflow-hidden z-10 pointer-events-none mask-linear-gradient">
                                <div v-for="dm in activeDanmakuList" :key="dm.id"
                                    class="danmaku-item text-white/90 text-lg lg:text-2xl font-bold drop-shadow-md"
                                    :style="{ top: dm.top + '%', animationDuration: dm.speed + 's', fontSize: dm.size + 'px' }">
                                    {{ dm.text }}
                                </div>
                            </div>

                            <!-- 播放器控制栏 (Hover显示) -->
                            <div
                                class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover/player:opacity-100 transition-opacity duration-300">
                                <!-- 进度条 -->
                                <div
                                    class="w-full h-1 bg-white/20 rounded-full mb-4 cursor-pointer hover:h-1.5 transition-all relative group/progress">
                                    <div class="w-1/3 h-full bg-indigo-500 rounded-full relative">
                                        <div
                                            class="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow scale-0 group-hover/progress:scale-100 transition-transform">
                                        </div>
                                    </div>
                                </div>
                                <!-- 按钮组 -->
                                <div class="flex justify-between items-center">
                                    <div class="flex gap-4">
                                        <i data-lucide="play" class="w-6 h-6 fill-white"></i>
                                        <i data-lucide="volume-2" class="w-6 h-6"></i>
                                        <span class="text-sm font-medium">04:20 / {{ currentVideo.duration }}</span>
                                    </div>
                                    <div class="flex gap-4">
                                        <span class="text-sm font-bold border border-white/30 px-2 rounded">4K</span>
                                        <i data-lucide="maximize" class="w-6 h-6"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- 中心播放按钮 -->
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <button
                                    class="w-20 h-20 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/20 opacity-0 group-hover/player:opacity-100 transition-all scale-90 group-hover/player:scale-100">
                                    <i data-lucide="play" class="w-8 h-8 fill-white ml-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 侧边互动区 (右侧/下方) -->
                    <div
                        class="w-full lg:w-[400px] h-1/2 lg:h-full glass-panel border-l border-white/10 border-t-0 flex flex-col z-20">

                        <!-- UP主信息 -->
                        <div class="p-6 border-b border-white/5 flex items-center justify-between bg-white/5">
                            <div class="flex items-center gap-3">
                                <img :src="currentVideo.avatar"
                                    class="w-10 h-10 rounded-full border border-indigo-500/30">
                                <div>
                                    <h3 class="font-bold text-sm text-gray-100">{{ currentVideo.author }}</h3>
                                    <p class="text-xs text-gray-400 mt-0.5">粉丝 58.2万</p>
                                </div>
                            </div>
                            <button
                                class="px-5 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded-full spring-transition click-spring shadow-lg shadow-indigo-600/20">
                                关注
                            </button>
                        </div>

                        <!-- 视频标题与数据 + AI 入口 -->
                        <div class="px-6 py-4 border-b border-white/5 space-y-3">
                            <h2 class="text-lg font-bold leading-snug text-white">{{ currentVideo.title }}</h2>
                            <div class="flex items-center gap-4 text-gray-400 text-xs">
                                <div
                                    class="flex items-center gap-1 hover:text-red-400 cursor-pointer transition-colors">
                                    <i data-lucide="flame" class="w-4 h-4"></i> 2.4万
                                </div>
                                <div
                                    class="flex items-center gap-1 hover:text-blue-400 cursor-pointer transition-colors">
                                    <i data-lucide="message-circle" class="w-4 h-4"></i> 1,024
                                </div>
                                <span class="ml-auto text-gray-600">{{ currentVideo.date }}</span>
                            </div>

                            <!-- AI 视频洞察区域 -->
                            <div class="mt-2">
                                <button v-if="!aiSummary && !isGeneratingAI" @click="generateVideoInsight"
                                    class="w-full flex items-center justify-center gap-2 py-2 rounded-xl bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 text-indigo-300 text-xs font-bold hover:bg-white/5 transition-all group">
                                    <i data-lucide="sparkles"
                                        class="w-3.5 h-3.5 group-hover:rotate-12 transition-transform"></i>
                                    ✨ 生成 AI 视频洞察
                                </button>

                                <div v-if="isGeneratingAI"
                                    class="w-full p-4 rounded-xl ai-card animate-pulse flex items-center justify-center gap-2 text-xs text-indigo-200">
                                    <i data-lucide="loader-2" class="w-3.5 h-3.5 animate-spin"></i>
                                    Gemini 正在分析视频内容...
                                </div>

                                <div v-if="aiSummary"
                                    class="p-4 rounded-xl ai-card space-y-2 animate-in fade-in slide-in-from-bottom-2">
                                    <div
                                        class="flex items-center gap-2 text-indigo-300 text-xs font-bold uppercase tracking-wider mb-1">
                                        <i data-lucide="bot" class="w-3.5 h-3.5"></i>
                                        Gemini Insight
                                    </div>
                                    <div class="text-xs text-gray-200 leading-relaxed space-y-2"
                                        v-html="renderMarkdown(aiSummary)"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 评论/弹幕列表 -->
                        <div class="flex-1 overflow-y-auto p-0 relative bg-black/20" ref="commentList">
                            <!-- 评论列表 -->
                            <div class="p-4 space-y-5">
                                <div v-for="(comment, index) in comments" :key="index"
                                    class="flex gap-3 animate-slide-up" :style="{ animationDelay: index * 50 + 'ms' }">
                                    <img :src="`https://api.dicebear.com/7.x/notionists/svg?seed=${index + 5}`"
                                        class="w-8 h-8 rounded-full bg-gray-700 mt-1">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-baseline">
                                            <span class="text-xs font-bold text-gray-400">用户_{{ 1000 + index }}</span>
                                            <span class="text-[10px] text-gray-600">2小时前</span>
                                        </div>
                                        <p class="text-sm text-gray-200 mt-1 leading-relaxed">{{ comment }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 底部输入栏 (带 AI 辅助) -->
                        <div class="p-4 bg-black/40 backdrop-blur-lg border-t border-white/5">
                            <div class="relative w-full">
                                <input v-model="inputDanmaku" @keyup.enter="send" type="text"
                                    :placeholder="isMagicLoading ? 'Gemini 正在思考有趣的弹幕...' : '发个弹幕见证当下...'"
                                    :disabled="isMagicLoading"
                                    class="w-full bg-white/5 border border-white/10 rounded-full py-3 pl-10 pr-12 text-sm text-white focus:bg-white/10 focus:border-indigo-500/50 focus:outline-none transition-all placeholder-gray-500 disabled:opacity-50">

                                <!-- AI Magic Button -->
                                <button @click="magicComment" :disabled="isMagicLoading" title="AI 帮你写评论"
                                    class="absolute left-1.5 top-1.5 p-1.5 rounded-full hover:bg-indigo-500/20 text-indigo-400 transition-colors group z-10">
                                    <i :data-lucide="isMagicLoading ? 'loader-2' : 'sparkles'"
                                        :class="['w-4 h-4', isMagicLoading ? 'animate-spin' : '']"></i>
                                </button>

                                <button @click="send"
                                    class="absolute right-2 top-2 p-1.5 bg-indigo-600 rounded-full hover:bg-indigo-500 text-white transition-colors click-spring">
                                    <i data-lucide="send" class="w-4 h-4 ml-0.5"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, onMounted, nextTick } = Vue;

        // Gemini API Setup
        const apiKey = ""; // API key injection handled by environment

        // Helper to call Gemini API
        async function callGemini(prompt) {
            if (!apiKey) {
                console.error("API Key missing");
                return "Please set API Key";
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI 暂时休息了，请稍后再试。";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "网络连接异常。";
            }
        }

        createApp({
            setup() {
                // 状态管理
                const isLoading = ref(false);
                const loadPercent = ref(0);
                const activeTab = ref('home');
                const currentVideo = ref(null);
                const inputDanmaku = ref('');
                const activeDanmakuList = ref([]);

                // AI State
                const aiSummary = ref("");
                const isGeneratingAI = ref(false);
                const isMagicLoading = ref(false);

                // 静态数据
                const navItems = [
                    { id: 'home', name: '首页推荐', icon: 'home' },
                    { id: 'trending', name: '热门趋势', icon: 'flame' },
                    { id: 'subs', name: '关注动态', icon: 'users' },
                    { id: 'library', name: '播放历史', icon: 'library' },
                ];

                const categories = ['全部', '科技数码', '游戏实况', '影视解说', '生活Vlog', '美食制作', '音乐现场', '极客', '汽车'];

                const mockVideos = [
                    { id: 1, title: "沉浸式体验：在雨夜的东京街头漫步 8K HDR", author: "WalkJapan", views: "24万", date: "2天前", duration: "12:34", cover: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" },
                    { id: 2, title: "Apple Vision Pro 深度评测：空间计算的未来？", author: "TechReview", views: "89万", date: "5小时前", duration: "18:20", cover: "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Tech" },
                    { id: 3, title: "【4K】2025 极简主义桌面搭建指南 Desk Setup", author: "Minimalist", views: "12万", date: "1周前", duration: "08:45", cover: "https://images.unsplash.com/photo-1486946255434-2466348c2166?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Desk" },
                    { id: 4, title: "Cyberpunk 2077: 往日之影 最终结局剧情向", author: "GameMaster", views: "55万", date: "3天前", duration: "45:10", cover: "https://images.unsplash.com/photo-1552820728-8b83bb6b773f?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Gamer" },
                    { id: 5, title: "十分钟学会 Vue 3 Composition API", author: "CodeWithMe", views: "6.7万", date: "2天前", duration: "10:05", cover: "https://images.unsplash.com/photo-1587620962725-abab7fe55159?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Code" },
                    { id: 6, title: "如何在家做出米其林级别的惠灵顿牛排", author: "ChefGordon", views: "102万", date: "1天前", duration: "15:30", cover: "https://images.unsplash.com/photo-1600891964092-4316c288032e?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Food" },
                    { id: 7, title: "冰岛环岛自驾游 Vlog ep.1", author: "TravelTheWorld", views: "33万", date: "4天前", duration: "22:15", cover: "https://images.unsplash.com/photo-1476610182048-b716b8518aae?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Trip" },
                    { id: 8, title: "Lo-Fi Hip Hop Radio - Beats to Relax/Study to", author: "LofiGirl", views: "Live", date: "直播中", duration: "Live", cover: "https://images.unsplash.com/photo-1516280440614-6697288d5d38?w=800&q=80", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Music" }
                ];

                const videos = ref(mockVideos);

                const comments = ref([
                    "这个UI设计太绝了，求开源！",
                    "up主高产似母猪",
                    "第一视角既视感太强了",
                    "背景音乐请问是什么？",
                    "这就去买食材做起来",
                    "这就是未来的交互方式吗",
                    "火钳刘明",
                    "不仅视频质量高，网页做得也太好看了"
                ]);

                const defaultDanmaku = ["前方高能", "好听到怀孕", "见证历史", "太强了", "又在骗我买装备", "泪目", "这个转场丝滑", "233333"];
                let danmakuInterval = null;

                // 方法
                const triggerLoad = (cb) => {
                    isLoading.value = true;
                    loadPercent.value = 0;
                    let p = 0;
                    const timer = setInterval(() => {
                        p += Math.random() * 15;
                        if (p > 90) {
                            clearInterval(timer);
                            loadPercent.value = 100;
                            setTimeout(() => {
                                isLoading.value = false;
                                loadPercent.value = 0;
                                if (cb) cb();
                            }, 200);
                        } else {
                            loadPercent.value = p;
                        }
                    }, 50);
                };

                const goHome = () => {
                    if (activeTab.value !== 'home') {
                        triggerLoad(() => activeTab.value = 'home');
                    }
                };

                const openVideo = (video) => {
                    triggerLoad(() => {
                        currentVideo.value = video;
                        aiSummary.value = ""; // Clear old summary
                        isGeneratingAI.value = false;
                        activeDanmakuList.value = [];
                        startDanmakuEngine();
                        nextTick(() => lucide.createIcons());
                    });
                };

                const closeVideo = () => {
                    currentVideo.value = null;
                    stopDanmakuEngine();
                };

                // AI Functions
                const generateVideoInsight = async () => {
                    if (!currentVideo.value || isGeneratingAI.value) return;
                    isGeneratingAI.value = true;

                    const prompt = `你是 GlassStream 视频平台的 AI 助手。请根据视频标题'${currentVideo.value.title}'和作者'${currentVideo.value.author}'，生成一段简短精彩的视频内容简介（50字以内）以及三个看点（bullet points）。请用中文回答，语气轻松吸引人，并适当使用 emoji。`;

                    aiSummary.value = await callGemini(prompt);
                    isGeneratingAI.value = false;
                };

                const magicComment = async () => {
                    if (!currentVideo.value || isMagicLoading.value) return;
                    isMagicLoading.value = true;

                    const prompt = `请为标题为'${currentVideo.value.title}'的视频写一条简短有趣的中文评论或弹幕（30字以内），带一个emoji，风格要像真实的互联网用户。只返回评论内容本身。`;

                    const result = await callGemini(prompt);
                    inputDanmaku.value = result.replace(/^["']|["']$/g, ''); // Remove quotes if any
                    isMagicLoading.value = false;
                };

                const renderMarkdown = (text) => {
                    // Simple markdown rendering if marked is available, else plain text
                    return typeof marked !== 'undefined' ? marked.parse(text) : text;
                };

                // 简单的弹幕引擎
                const startDanmakuEngine = () => {
                    if (danmakuInterval) clearInterval(danmakuInterval);
                    danmakuInterval = setInterval(() => {
                        if (Math.random() > 0.4) {
                            const text = defaultDanmaku[Math.floor(Math.random() * defaultDanmaku.length)];
                            addDanmaku(text);
                        }
                    }, 800);
                };

                const stopDanmakuEngine = () => {
                    if (danmakuInterval) clearInterval(danmakuInterval);
                    activeDanmakuList.value = [];
                };

                const addDanmaku = (text, isSelf = false) => {
                    const id = Date.now() + Math.random();
                    const dm = {
                        id,
                        text,
                        top: Math.random() * 80, // 0-80% top
                        speed: isSelf ? 8 : 6 + Math.random() * 6, // 速度
                        size: isSelf ? 24 : 16 + Math.random() * 8 // 字体大小
                    };
                    activeDanmakuList.value.push(dm);

                    // 动画结束后清理（简单处理）
                    setTimeout(() => {
                        activeDanmakuList.value = activeDanmakuList.value.filter(d => d.id !== id);
                    }, 15000);
                };

                const send = () => {
                    if (!inputDanmaku.value.trim()) return;
                    // 发送弹幕
                    addDanmaku(inputDanmaku.value, true);
                    // 添加评论
                    comments.value.unshift(inputDanmaku.value);
                    inputDanmaku.value = '';
                };

                onMounted(() => {
                    lucide.createIcons();
                    triggerLoad();
                });

                return {
                    isLoading,
                    loadPercent,
                    navItems,
                    activeTab,
                    categories,
                    videos,
                    currentVideo,
                    openVideo,
                    closeVideo,
                    goHome,
                    activeDanmakuList,
                    inputDanmaku,
                    send,
                    comments,
                    // AI Props
                    aiSummary,
                    isGeneratingAI,
                    generateVideoInsight,
                    isMagicLoading,
                    magicComment,
                    renderMarkdown
                };
            },
            updated() {
                lucide.createIcons();
            }
        }).mount('#app');
    </script>
</body>

</html>